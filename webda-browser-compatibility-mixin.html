<script>
const WebdaBrowserCompatibilityMixin = Sup => class extends Sup {
  static get properties() {
  return {
    detectedBrowser: {
      type: Object,
      notify: true
    },
    compatibility: {
      type: Boolean,
      notify: true
    },
    bannedAgents : {
      type: Object,
      value : [
        {name: "Chrome", untilVersion: "59.0.3071.114"},
        {name: "MSIE" , untilVersion: "42"}
      ]
    },
    minAgents : {
      type: Object,
      value : [
        {name: "Chrome", minVersion: "59.0.3071.115"},
        {name: "Firefox" , minVersion: "42"},
      ]
    }
  };
}

  ready () {
    super.ready();
    this._browserVersionAnalysis();
  }

  //adapted from Alexey Bass

  _versionCompare (left, right) {
      if (typeof(left) != 'string' || typeof(right) != 'string') {
          return false;
      }

      var a = left.split('.')
      ,   b = right.split('.')
      ,   i = 0, len = Math.max(a.length, b.length);

      for (; i < len; i++) {
          if ((a[i] && !b[i] && parseInt(a[i]) > 0) || (parseInt(a[i]) > parseInt(b[i]))) {
              return 1;
          }
          else if ((b[i] && !a[i] && parseInt(b[i]) > 0) || (parseInt(a[i]) < parseInt(b[i]))) {
              return -1;
          }
      }

      return 0;
  }

  _browserVersionAnalysis () {

    this.detectedBrowser = new UAParser().getBrowser();

    for (var j in this.bannedAgents) {

      if (this.bannedAgents[j].name === this.detectedBrowser.name
        && this._versionCompare(this.detectedBrowser.version, this.bannedAgents[j].untilVersion) < 0) {
        this.compatibility = false;
        return;
      }
    }

    for (var k in this.minAgents) {
      if (this.minAgents[k].name === this.detectedBrowser.name
      && this._versionCompare(this.detectedBrowser.version, this.minAgents[k].minVersion) >= 0) {
        this.compatibility = true;
        return;
      }
    }
    this.compatibility = false;
  }
}
</script>